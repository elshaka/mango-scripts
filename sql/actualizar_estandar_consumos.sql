UPDATE batch_hoppers_lots INNER JOIN batches ON batches.id = batch_hoppers_lots.batch_id INNER JOIN orders ON orders.id = batches.order_id INNER JOIN recipes ON recipes.id = orders.recipe_id LEFT OUTER JOIN ingredients_recipes ON ingredients_recipes.recipe_id = recipes.id LEFT OUTER JOIN medicaments_recipes ON medicaments_recipes.id = orders.medicament_recipe_id LEFT OUTER JOIN ingredients_medicaments_recipes ON ingredients_medicaments_recipes.medicament_recipe_id = medicaments_recipes.id INNER JOIN hoppers_lots ON hoppers_lots.id = batch_hoppers_lots.hopper_lot_id INNER JOIN lots ON lots.id = hoppers_lots.lot_id SET standard_amount = COALESCE(ingredients_recipes.amount, ingredients_medicaments_recipes.amount, 0) WHERE lots.ingredient_id IN (ingredients_recipes.ingredient_id, ingredients_medicaments_recipes.ingredient_id);
